<!DOCTYPE html>
<html>
<head>
    <title>Toll Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .transaction-card { margin-bottom: 20px; padding: 15px; border-radius: 8px; }
        .block-card { background: #f8f9fa; padding: 15px; margin-bottom: 20px; }
    </style>
</head>
<body class="container py-4">
    <h1 class="mb-4">üöó Toll Management System</h1>
    
    <!-- Transaction Form -->
    <div class="card transaction-card">
        <div class="card-body">
            <h3>New Transaction</h3>
            <form id="transactionForm">
                <div class="row g-3 mb-3">
                    <div class="col-md-3">
                        <input type="text" class="form-control" placeholder="Car Number" name="car_number" required>
                    </div>
                    <div class="col-md-3">
                        <input type="text" class="form-control" placeholder="Owner" name="owner" required>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" name="vehicle_type" required>
                            <option value="">Vehicle Type</option>
                            <option value="Car">Car</option>
                            <option value="Truck">Truck</option>
                            <option value="Bus">Bus</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <input type="number" class="form-control" placeholder="Toll Amount" name="toll_amount" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Add Transaction</button>
            </form>
        </div>
    </div>

    <!-- Controls -->
    <div class="d-flex justify-content-end mb-4 gap-2">
        <button class="btn btn-success" onclick="mineBlock()">‚õèÔ∏è Mine Block</button>
        <a href="/generate_pdf" class="btn btn-primary">üìÑ Download PDF</a>
    </div>

    <!-- Blockchain Display -->
    <h3 class="mt-4">Blockchain</h3>
    <div id="chainDisplay"></div>

    <script>
        // Submit transaction
        document.getElementById('transactionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            
            try {
                const response = await fetch('/transactions/new', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                alert(result.message);
                e.target.reset();
            } catch (error) {
                console.error('Error:', error);
            }
        });

        // Mine block
        async function mineBlock() {
            try {
                const response = await fetch('/mine', { method: 'GET' });
                const result = await response.json();
                alert(`Block mined! Index: ${result.index}`);
                updateChainDisplay();
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Display blockchain
        async function updateChainDisplay() {
            const response = await fetch('/chain');
            const data = await response.json();
            const chainDiv = document.getElementById('chainDisplay');
            chainDiv.innerHTML = '';
            
            data.chain.forEach(block => {
                const blockHtml = `
                    <div class="block-card card mb-2">
                        <div class="card-body">
                            <h5>Block ${block.index}</h5>
                            <p>Hash: ${block.present_hash}</p>
                            <p>Transactions: ${block.transactions.length}</p>
                        </div>
                    </div>
                `;
                chainDiv.innerHTML += blockHtml;
            });
        }

        // Initial load
        updateChainDisplay();
    </script>
</body>
</html>
